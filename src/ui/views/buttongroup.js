// Copyright (c) 2013 M-Way Solutions GmbH
// http://github.com/mwaylabs/The-M-Project/blob/absinthe/MIT-LICENSE.txt

/**
 * @module M.ButtonGroupView
 * @type {*}
 * @extends M.View
 */
M.ButtonGroupView = M.View.extend({

    _type: 'M.ButtonGroupView',

    _templateString: M.TemplateManager.get('buttongroup.ejs'),

    _internalCssClasses: 'clearfix',

    /**
     * Defines whether Buttongroup is aligned vertical or not
     */
    verticalAlignment: NO,

    keepActiveState: YES,

    setActive: function( view ) {
        if(!this.keepActiveState){
            return;
        }
        var setActiveView = M.isView(view) ? view : this._getChildView(view);
        _.each(this.childViews, function( child ) {
            child.deactivate();
        }, this);
        setActiveView.activate();
    },

    getActive: function() {
        return _.find(this._childViews, function( view ) {
            return view.isActive();
        }, this);
    },

    initialize: function() {
        M.View.prototype.initialize.apply(this, arguments);
        var that = this;
        if( this._childViews ) {
            _.each(this._childViews, function( child, key ) {

                this._childViews[key] = child.extend({
                    _isInButtonGroup: this.keepActiveState ? YES : NO,
                    _internalEvents: {
                        touchstart: [function( events, element ) {
                            that.setActive(element);
                        }],
                        mousedown: [function( events, element ) {
                            that.setActive(element);
                        }]
                    }
                });
            }, this);
        }

    },

    _preRender: function() {
        M.View.prototype._preRender.apply(this, arguments);
        _.each(this.childViews, function( child ) {
            if( child.selected ) {
                this.setActive(child);
            }
        }, this);
    },

    _addClassNames: function() {
        M.View.prototype._addClassNames.apply(this, arguments);
        if(this.verticalAlignment){
            this.$el.addClass('vertical');
        }
        return;
    }
});
